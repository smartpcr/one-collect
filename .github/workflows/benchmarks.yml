name: Benchmarks

permissions:
  contents: read

on:
  workflow_call:
    inputs:
      os:
        required: true
        type: string
        description: 'Operating system (ubuntu-latest, windows-latest)'
      container:
        required: false
        type: string
        description: 'Container image (e.g., rust:alpine)'
      setup-command:
        required: false
        type: string
        description: 'Setup command to run before checkout (e.g., apk add --no-cache musl-dev)'
      platform-name:
        required: true
        type: string
        description: 'Platform name for display (e.g., Linux-glibc-x64, Windows-x64)'

jobs:
  benchmarks:
    name: Run Benchmarks (${{ inputs.platform-name }})
    runs-on: ${{ inputs.os }}
    container: ${{ inputs.container || null }}

    steps:
    - name: Setup environment
      if: ${{ inputs.setup-command != '' }}
      run: ${{ inputs.setup-command }}
    
    - uses: actions/checkout@v3
    
    - name: Run benchmarks
      working-directory: one_collect
      run: cargo bench --verbose
